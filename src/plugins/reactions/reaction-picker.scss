/**
 * Reaction Picker Styles
 * Styles for the emoji reaction picker UI and reaction bubbles
 * 
 * Components:
 * - .reaction-picker: Glassmorphic popup with popular emojis
 * - .reaction-item: Individual emoji buttons
 * - .dropdown-menu: Full emoji picker dropdown
 * - .chat-msg__reaction: Slack-style reaction bubbles on messages
 */

/* Pop-in animation for picker appearance */
@keyframes popIn {
    0% {
        opacity: 0;
        transform: scale(0.5) translateY(10px);
    }
    100% {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

@keyframes popOut {
    0% {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
    100% {
        opacity: 0;
        transform: scale(0.5) translateY(10px);
    }
}


/* Main reaction picker container - glassmorphic design */
converse-reaction-picker {
    position: absolute;
    inset: 0; 
    width: 100%;
    height: 100%;
    overflow: visible;
    z-index: 999;
    pointer-events: none;
}

.reaction-picker {
    position: absolute;
    top: 2.25rem; 
    right: 0; 
    z-index: 1000;
    width: max-content;
    pointer-events: auto; 
    background: var(--reaction-picker-bg, rgba(255, 255, 255, 0.1));
    backdrop-filter: blur(25px);
    -webkit-backdrop-filter: blur(25px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 30px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
    padding: 6px 10px;
    display: flex;
    gap: 8px;
    animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    transform-origin: top right;

    &.closing {
        animation: popOut 0.2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    /* Shifted left to avoid screen edge overflow */
    &.shifted {
        right: 0;
    }

    &.popular {
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: center;
        align-items: center;
    }

    /* Individual emoji button in picker */
    .reaction-item {
        width: 32px;
        height: 32px;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.25rem;
        border-radius: 50%;
        transition: all 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        position: relative;
        flex-shrink: 0;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  

        &:hover {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
            transform: scale(1.15);
            z-index: 2;
        }

        &:active, &.active {
            transform: scale(0.9);
            background-color: rgba(255, 255, 255, 0.4);
        }

        /* "More" button (plus icon) */
        &.more {
            font-size: 0.8rem;
            
            &:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: scale(1.15);
            }
        }
    }

    /* Dropdown container for full emoji picker */
    .dropdown {
        display: flex;
        position: relative;
        align-items: center;
        flex-shrink: 0;
    }

    /* Full emoji picker dropdown menu */
    .dropdown-menu {
        display: none;
        background: var(--background-color);
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        padding: 0.5rem;
        overflow: visible; /* Allow skin-tone picker to extend horizontally */
        min-width: 18rem; 
        max-width: 22rem;
        
        /* Fallback positioning for browsers without CSS anchor positioning */
        position: absolute; 
        top: calc(100% + 8px);
        left: 0;
        z-index: 1000;

        /* CSS Anchor Positioning (modern browsers) */
        /* Anchor name defined in inline style of the button */
        position-area: bottom span-right; 
        position-try-fallbacks: flip-block, flip-inline, bottom span-left;
        margin-top: 8px;

        /* Bootstrap toggles "show" class to display */
        &.show {
            display: block;
        }
        
        li {
            width: 100%;
        }
    }

    &.dropup {
        top: auto;
        bottom: 100%; 
        right: 0 !important; 
        left: auto !important;
        margin-bottom: 8px;
        transform-origin: bottom right;

        .dropdown-menu {
            top: auto;
            bottom: calc(100% + 8px);
            margin-top: 0;
            margin-bottom: 8px;
            
            /* CSS Anchor Positioning (modern browsers) */
            position-area: top span-right; 
            position-try-fallbacks: flip-block, flip-inline, top span-left;
        }
    }
}

/* Container for reaction bubbles on messages */
.chat-msg__reactions {
    display: flex;
    flex-wrap: wrap;
    gap: 0.375rem;
    margin-top: 0.5rem;
    margin-left: 0;
    padding-left: 0;
    width: 100%;
}

/* Individual reaction bubble (Slack-style) */
.chat-msg__reaction {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.25rem;
    background: var(--reaction-bg, rgba(29, 155, 209, 0.1));
    border: 1px solid var(--reaction-border, rgba(29, 155, 209, 0.2));
    border-radius: 12px !important; /* Rounded pill shape */
    min-width: auto;
    height: 22px;
    padding: 0.125rem 0.5rem;
    font-size: 0.75rem;
    line-height: 1;
    cursor: pointer;
    
    /* Style for user's own reactions (highlighted) */
    &.reacted-by-user {
        background: var(--reaction-bg-active, rgba(29, 155, 209, 0.2));
        border-color: var(--reaction-border-active, rgba(29, 155, 209, 0.4));
        font-weight: 500;
    }
    
    /* Emoji within the bubble */
    .emoji {
        font-size: 0.875rem;
        line-height: 1;
    }
    
    /* Count of users who reacted with this emoji */
    .count {
        display: inline;
        font-size: 0.6875rem;
        font-weight: 600;
        color: var(--text-color, #1d1c1d);
        margin-left: 0.125rem;
    }
}